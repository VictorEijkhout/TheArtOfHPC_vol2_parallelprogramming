% -*- latex -*-
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%
%%%% This text file is part of the source of 
%%%% `Parallel Programming for Science and Engeneering'
%%%% by Victor Eijkhout, copyright 2012-2026
%%%%
%%%% This book is distributed under a Creative Commons Attribution 3.0
%%%% Unported (CC BY 3.0) license and made possible by funding from
%%%% The Saylor Foundation \url{http://www.saylor.org}.
%%%%
%%%% pcseslidemacs.tex : goes after snippetmacs
%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%
%%%% Prototypes
%%%%
\def\underscore{_}
\def\mpiRoutineRef#1{\RoutineRefStyle\verbatiminput{#1}}
%% \def\RoutineRefStyle{\scriptsize}

\newcommand\standardversion{}
%%
%% macro for prototype slides in all the enabled languages
%%
\def\mpiproto#{\begingroup \catcode`\_=12
  \afterassignment\mpiprotoinclude \def\protoname}
%%
%% macro for a single prototype slide with all the enabled languages
%%
\def\mpiprotocombined#{\begingroup \catcode`\_=12
  \afterassignment\mpiprotoincludecombined \def\protoname}

%%%%
%%%% Complicated implementation of the above
%%%%
\newcommand\mpiprotoinclude{
  \cfprotoslide
  \endgroup
}
\let\mpiprotoincludecombined=\mpiprotoinclude

  %% \addtocounter{slidecount}{-1}
  %% \mplprotoslide{MPI_Gatherv}

\begin{python}
% only python
\renewcommand\mpiprotoinclude{
  \cfprotoslide
  \pyprotoslide
  \endgroup
}
\let\mpiprotoincludecombined=\mpiprotoinclude
\end{python}

\begin{mpl}
% only add mpl
\renewcommand\mpiprotoinclude{
  \cfprotoslide
  \mplprotoslide
  \endgroup
}
\renewcommand\mpiprotoincludecombined{
  \cflprotoslide
  \endgroup
}

\begin{python}
% both mpl & python
\renewcommand\mpiprotoinclude{
  \cfprotoslide
  \mplprotoslide
  \pyprotoslide
  \endgroup
}
\end{python}
\end{mpl}

%
% Proto with only C/F
%
\newcommand\cfprotoslide{
  \begin{frame}[containsverbatim]\frametitle{\texttt\protoname}
      % mpi standard macros
      \def\MPI/{MPI}\def\mpi/{MPI}\def\RMA/{RMA}
      \def\mpifunc##1{\texttt{##1}}
      \let\mpiarg\mpifunc \let\mpicode\mpifunc
      \let\const\mpifunc  \let\constskip\mpifunc
    \tiny
    \edef\tmp{\lowercase{\def\noexpand\standardroutine{\protoname}}}\tmp
    \def\stdtmp{standard/\standardroutine\standardversion}
    \IfFileExists
        {\stdtmp.tex}
        {\message{including standard: \stdtmp.tex}\input{\stdtmp}}
        {% if no standard file, then maybe handwritten file
          \message{Could not find: \stdtmp.tex}
          \IfFileExists
              {mpireference/\protoname.tex}
              {\verbatiminput{mpireference/\protoname}}{}}
        %\expandafter\mpiRoutineRef\expandafter{\protoname}
  \end{frame}
}

\newcommand\cflprotoslide{
  \begin{frame}[containsverbatim]\frametitle{\texttt\protoname}
      % mpi standard macros
      \def\MPI/{MPI}\def\mpi/{MPI}\def\RMA/{RMA}
      \def\mpifunc##1{\texttt{##1}}
      \let\mpiarg\mpifunc \let\mpicode\mpifunc
      \let\const\mpifunc  \let\constskip\mpifunc
    \tiny
    \edef\tmp{\lowercase{\def\noexpand\standardroutine{\protoname}}}\tmp
    \def\stdtmp{standard/\standardroutine\standardversion}
    \IfFileExists
        {\stdtmp.tex}
        {\message{including standard: \stdtmp.tex}\input{\stdtmp}}
        {% if no standard file, then maybe handwritten file
          \message{Could not find: \stdtmp.tex}
          \IfFileExists
              {mpireference/\protoname.tex}
              {\verbatiminput{mpireference/\protoname}}{}}
        %\expandafter\mpiRoutineRef\expandafter{\protoname}

    \def\hyperlink##1##2{##2}
    \def\href##1{}
    \def\hypertarget##1{}
    \let\+\relax
    \tiny
    \edef\tmp{\lowercase{\def\noexpand\standardroutine{\protoname}}}\tmp
    \IfFileExists
        {mplreference/\standardroutine.tex}
        {\lstinputlisting{mplreference/\standardroutine}}
        {Missing MPL proto: \standardroutine}

  \end{frame}
}

%%
%% MPL protos
%%
\newcommand\mplprotoslide{
  \begin{frame}[containsverbatim]\frametitle{\texttt{MPL: \protoname}}
      % doxy standard macros
    \def\hyperlink##1##2{##2}
    \def\href##1{}
    \def\hypertarget##1{}
    \let\+\relax
    \tiny
    \edef\tmp{\lowercase{\def\noexpand\standardroutine{\protoname}}}\tmp
    \IfFileExists
        {mplreference/\standardroutine.tex}
        {\lstinputlisting{mplreference/\standardroutine}}
        {Missing MPL proto: \standardroutine}
  \end{frame}
}
    
%%
%% PY protos
%%
\newcommand\pyprotoslide{
  \begin{frame}[containsverbatim]\frametitle{\texttt{Python: \protoname}}
      % doxy standard macros
    \def\hyperlink##1##2{##2}
    \def\href##1{}
    \def\hypertarget##1{}
    \let\+\relax
    \tiny
    \edef\tmp{\lowercase{\def\noexpand\standardroutine{\protoname}}}\tmp
    \def\stdtmp{standardp/\standardroutine}
    \IfFileExists
        {\stdtmp.tex}
        {\lstinputlisting{\stdtmp}}
        {Missing Python proto: \stdtmp}
  \end{frame}
}

\newcommand\ListingFileInsert[2]{
    \IfFileExists
        {#1/#2.tex}
        {\lstinputlisting{#1/#2}}
        {Missing proto: #2 for #1}
}

